<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">
  <div layout:fragment="content">
    

    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="breadcrumb__links">
              <a th:href="@{categories(page=${requestDto.page},type=${requestDto.type},keyword=${requestDto.keyword})}"><i class="fa fa-home"></i> 전체</a>
              <a href="">[[${dto.category}]]</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Anime Section Begin -->
    <section class="anime-details spad">
      <div class="container">
        <div class="anime__details__content">
          <div class="row">
            <div class="col-lg-3">
              <div>
                <!-- <div class="anime__details__pic set-bg" th:style=" 'background-image: url('|/upload/display?fileName=${dto.productImageDtos[0].getImageURL()}|')'"> -->
                <div class="anime__details__pic set-bg" data-setbg="/upload/display?fileName=[[${dto.productImageDtos[0].getImageURL()}]]">
                </div>
                <!-- <script>console.log(th:src="|/upload/display?fileName=${dto.productImageDtos[0].getImageURL()}|")</script> -->
                <img class="product_details_pic set-bg" th:src="|/upload/display?fileName=${dto.productImageDtos[0].getImageURL()}|">
                <script>console.log("/upload/display?fileName=[[${dto.productImageDtos[0].getImageURL()}]]")</script>
                  <img src="/img/anime/left.png" class="arows left_arrow" onclick="imgChange(-1)">
                  <img src="/img/anime/right.png" class="arrows right_arrow" onclick="imgChange(+1)">
                </img>
              </div>
              <script>
                let img_arr = [];
              </script>
              <div class="product_details_pic_sub" th:each="image : ${dto.productImageDtos}" th:attr="data-file=${image.getImageURL()}">
                <!-- <div class="set-bg" data-setbg="image.getImageURL()"></div> -->
                <img class="sub_pic" th:if="${image.path != null}" th:src="|/upload/display?fileName=${image.getImageURL()}|" />
                <script>
                  image_url_src = "[[${image.getImageURL()}]]";
                  image_url_src = image_url_src.replaceAll("%", "/");
                  img_arr.push(image_url_src);
                  // console.log(image_url_src)
                </script>
              </div>

              


              <!-- 원본 이미지 데이터 -->
              <!-- <div class="item__details__pic__sub">
                <div class="set-bg" data-setbg="/img/anime/item1.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item2.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item3.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item4.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item5.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item6.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item7.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item8.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item9.jpg"></div>
                <div class="set-bg" data-setbg="/img/anime/item10.jpg"></div>
              </div> -->
              <!-- <img class="anime__details__pic__sub" src="img/anime/item1.jpg"></img> -->
              
            </div>
            <div class="col-lg-9">
              <div class="anime__details__text">
                <div class="anime__details__title">
                  <h3 th:text="${dto.title}">제목</h3>
                  <!-- [[${dto.title}]] -->
                  판매자 : <span th:text="${dto.writerName}">판매자</span>
                  배송방법 : <span>착불</span>
                </div>
                
                <!-- <p>
                  <div>경매가 : 100,000,000원</div>
                  <div>입찰인원 : 0</div>
                  <div>입찰 가능 기간 : 2024/05/11</div>
                </p> -->
                <!-- <div class="anime__details__widget"> -->
                <div class="product_bidding_info">
                  <div class="row">
                    <div class="col-lg-8 col-md-8">
                    <!-- <div> -->
                      <ul>
                        <li>경매시작가:<span> [[${#numbers.formatInteger(dto.startPrice, 3, 'COMMA')}]]원</span></li>
                        
                        <!-- 추가 해야함 -->
                        
                        <li>현재경매가: <span class="currPrice"></span></li>
                        <li>입찰 수:<span> 1,000번</span></li>
                        <li>종료 기간: <span class="end_date"></span></li>
                        <li>남은 시간: <span class="date_now"></span></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="anime__details__btn">
                  <!-- <a href="#" class="follow-btn"><i class="fa fa-heart-o"></i> 찜하기</a> -->
                  <div class="bidding_form">
                    <form th:action="@{/bidding/}" method="post" class="biddingForm" sec:authorize="hasAnyRole('MEMBER', 'ADMIN')">
                      <input type="hidden" name="mid" id="mid"  th:value="${#authentication.principal.memberDto.mid}">
                      <input type="hidden" name="mNickName" id="mNickName"  th:value="${#authentication.principal.memberDto.nickname}">
                      <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4">
                          <input type="text" name="biddingPrice" id="biddingPrice" placeholder="가격을 입력하세요" />
                        </div>
                        <div>
                          <button type="submit" class="bid-btn btn">입찰하기</button>
                          <!-- <i class="fa fa-angle-right"></i> -->
                        </div>
                      </div>
                      </form>
                      <div class="row">
                        <div class="anime__details__btn wish_list">
                          <a href="#" class="follow-btn"><i class="fa-regular fa-heart"></i> 찜하기</a>
                        </div>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 제품 설명, 경매기록, 댓글 nav tabs -->
        <div class="items_nav">
          <ul class="nav justify-content-center">
            <li class="nav-item detail active">
              <a class="nav-link" aria-current="page" href="">제품 설명</a>
            </li>
            <li class="nav-item bidding">
              <a class="nav-link" href="">경매 기록</a>
            </li>
            <li class="nav-item review">
              <a class="nav-link" href="">댓글</a>
            </li>
          </ul>
        </div>
        <div class="row item_nav_sub item_detail">
          <div class="section-title">
            <h5>상품설명</h5>
          </div>
          <div>
            [[${dto.content}]]
          </div>
        </div>
        <div class="row item_nav_sub item-bidding-record" style="display: none">
          <div class="section-title">
            <h5>경매기록</h5>
          </div>
          <div>
            <table class="w-full whitespace-no-wrap">
              <thead>
                <tr
                  class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800"
                >
                  <!-- <th class="px-4 py-3">번호</th> -->
                  <th class="px-4 py-3">닉네임</th>
                  <th class="px-4 py-3">입찰가</th>
                  <th class="px-4 py-3">입찰시간</th>
                </tr>
              </thead>
              <tbody class="divide-y dark:divide-gray-700 dark:bg-gray-800 biddingList">
                <!-- js 에서 출력 -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="row item_nav_sub item_review" style="display: none">
          <div class="col-lg-12 col-md-8">
            <div class="product_details_comment">
              <div class="section-title">
                <h5>상품평 (<span class="commentCnt">[[${dto.replyCnt}]]</span>개)</h5>
              </div>
              <div class="comments">
                <!-- JS에서 댓글 처리 -->
              </div>
            </div>
            <div class="anime__details__form">
              <div class="section-title">
                <h5>상품평 작성</h5>
              </div>
              <!-- th:action="@{/comments/product/}" -->
              <form th:action="@{/comments/}" method="post" class="comment-form" sec:authorize="hasAnyRole('MEMBER', 'ADMIN')">
                <input type="hidden" name="commentNo" id="commentNo" />
                <!-- 로그인 연결 후 th:value 추가 -->
                <input type="hidden" name="mid" id="mid" th:value="${#authentication.principal.memberDto.mid}">
                <input type="hidden" name="nickname" id="nickname" th:value="${#authentication.principal.memberDto.nickname}">
                <input type="hidden" name="email" id="email" th:value="${#authentication.principal.memberDto.email}">
                <!-- 나중에 로그인 후 닉네임 가져오기 -->
                <!-- <span id="nickname" th:text="${memberDto.nickname}"></span> -->
                <!-- <span id="nickname" th:text="${#authentication.principal.memberDto.nickname}"></span> -->
                <textarea id="text" placeholder="상품에 대한 의견을 작성해주세요"></textarea>
                <button type="submit"><i class="fa-regular fa-comments"></i> 작성</button>
              </form>
            </div>
          </div>
        </div>
        <!-- 관련 상품 form -->
        <form class="relation_categori_form">

          <div class="row item_nav">
            <div class="section-title">
              <h5>관련 상품</h5>
            </div>
          </div>
          <div class="row relative__products">
          </div>
        </form>
        <!-- [Swiper] 관련 상품 슬라이더 -->
        <div class="swiper">
          <div class="swiper-wrapper">
            <!-- 슬라이드 -->
            <div class="swiper-slide">
              <div class="category_item_pic set-bg">
                <img src="/img/popular/popular-1.jpg">
                <span class="categori_product_content">상품 1</span>
              </div>
            </div>
            <div class="swiper-slide product__item__pic set-bg">
              <img src="/img/popular/popular-2.jpg">상품 2
            </div>
            <div class="swiper-slide product__item__pic set-bg" data-setbg="/img/popular/popular-3.jpg">상품 3</div>
            <div class="swiper-slide product__item__pic set-bg" data-setbg="/img/popular/popular-4.jpg">상품 4</div>
            <div class="swiper-slide product__item__pic set-bg" data-setbg="/img/popular/popular-5.jpg">상품 5</div>
          </div>
          <!-- Add Pagination -->
          <div class="swiper-pagination"></div>
          <!-- <div class="swiper-pagination-bullet"></div> -->
          <!-- Add Arrows -->
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
      </div>
    </section>
    <!-- Anime Section End -->
    <th:block layout:fragment="script">
      <script>
        // 제품 번호 가져오기
        const pno = "[[${dto.pno}]]";
        // 제품 등록 일자 가져오기
        const sale_date = "[[${dto.createdDate}]]"
        const biddingDate = `[[${dto.biddingDate}]]`

        // 제품 이미지 가져오기
        const images = "[[${dto.productImageDtos}]]"

        // 경매 영역
        const biddingList = document.querySelector(".biddingList");

        // 최고가 영역
        

        // csrf 토큰
        const csrfValue = '[[${_csrf.token}]]';

      </script>
      <script th:src="@{/js/product_detail.js}"></script>
      <script th:src="@{/js/bidding.js}"></script>
      <script th:src="@{/js/comments.js}"></script>
  </th:block>
</html>
